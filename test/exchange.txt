setgridsize(300, 200, 4)
setcellsize(2e-9, 3e-9, 4e-9)

msat  = 800e3
aex   = 13e-12
m     = twodomain(1, 2, 3,  -1, -3, 5,  3, -1, 2)
enabledemag = false

defRegion(0, xrange(-inf, 0))
defRegion(1, xrange(0, inf))

print(average(B_exch))
print(average(B_exch.region(0)))
print(average(B_exch.region(1)))

tol := 1e-8

expect("B_exch", average(B_exch.region(0))[0],  0.00118888104756673, tol)
expect("B_exch", average(B_exch.region(0))[1], -0.00164631487528483, tol)
expect("B_exch", average(B_exch.region(0))[2], -0.00074591267903645, tol)

expect("B_exch", average(B_exch.region(1))[0], -0.00118888041178385, tol)
expect("B_exch", average(B_exch.region(1))[1],  0.00164631512959798, tol)
expect("B_exch", average(B_exch.region(1))[2],  0.00074591242472330, tol)

expect("B_exch", average(B_exch)[0], 0, tol)
expect("B_exch", average(B_exch)[1], 0, tol)
expect("B_exch", average(B_exch)[2], 0, tol)

