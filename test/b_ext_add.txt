N := 128
setgridsize(N, N, 1)

c := 5e-9
setcellsize(c, c, c)

Msat = 800e3
Aex  = 13e-12
m    = uniform(1, 0, 0)

mask := newSlice(3, N, N, 1)

wireX := 50e-9
wireY := 5e-9
wireDiam := 20e-9
current := vector(0, 0, -1)

for i:=0; i<N; i++{
	for j:=0; j<N; j++{
		r := index2coord(i, j, 0)
		r = r.sub(vector(wireX, wireY, 0)) // relative position to wire
	
		if r.len() >= wireDiam{
			b := r.cross(current).div(pow(r.len(), 3))
			mask.set(0, i, j, 0, b[0])
			mask.set(1, i, j, 0, b[1])
			mask.set(2, i, j, 0, b[2])
		}
	}
}

print(mask)

B_ext.add(mask, 0.01)
save(B_ext)

alpha = 3
MaxErr = 1e-4
RunWhile(MaxTorque > 1e-4)

print(average(m))
save(m)

