// test correct wrapping for exchange

setpbc(2, 2, 0)
Nx := 128
Ny := Nx/2
setgridsize(Nx, Ny, 1)
c := 5e-9
setcellsize(c, c, c)

Msat  = 1000e3
Aex   = 10e-12
alpha = 1

r := rect(Nx/2*c, Ny/2*c)
dx := Nx/2*c
dy := Ny/2*c

setgeom( r.repeat(Nx*c, Ny*c, 0).transl(dx, dy, 0) )
m = uniform(1, 0.1, 0.01)
save(m)
run(1e-9)
save(m)

 0.89947968, 1e-3)
 0.23352228, 1e-3)
-0.00010287, 1e-3)


setgeom( r.repeat(Nx*c, Ny*c, 0))
m = uniform(1, 0.1, 0.01)
save(m)
run(1e-9)
save(m)

m1 = average(m)
expect("mx", m1[0], 0.89947968, 1e-3)
expect("my", m1[1], 0.23352228, 1e-3)
expect("mz", m1[2],-0.00010287, 1e-3)

